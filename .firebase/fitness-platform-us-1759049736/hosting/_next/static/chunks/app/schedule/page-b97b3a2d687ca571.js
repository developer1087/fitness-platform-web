(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[826],{4531:(e,t,r)=>{Promise.resolve().then(r.bind(r,4675))},4675:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>h});var a=r(5155),i=r(2115),s=r(8576),n=r(1914),o=r(9708),l=r(4585);let d="availability_slots",c="booking_slots",m="calendar_settings";class u{static async createAvailabilitySlot(e,t){try{if(!l.db)throw Error("Firebase Firestore not initialized");let r=new Date().toISOString(),a={trainerId:e,dayOfWeek:t.dayOfWeek,startTime:t.startTime,endTime:t.endTime,isAvailable:!0,sessionTypes:t.sessionTypes,maxBookings:t.maxBookings,recurrenceType:t.recurrenceType,recurrenceEnd:t.recurrenceEnd,exceptions:[],notes:t.notes,location:t.location,isRemote:t.isRemote||!1,createdAt:r,updatedAt:r},i=await (0,o.gS)((0,o.rJ)(l.db,d),a);return await this.generateBookingSlotsFromAvailability(i.id,a),i.id}catch(e){throw console.error("Error creating availability slot:",e),e}}static async getTrainerAvailability(e){try{if(!l.db)throw Error("Firebase Firestore not initialized");let t=(0,o.P)((0,o.rJ)(l.db,d),(0,o._M)("trainerId","==",e),(0,o._M)("isAvailable","==",!0),(0,o.My)("dayOfWeek","asc"),(0,o.My)("startTime","asc")),r=await (0,o.GG)(t),a=[];return r.forEach(e=>{a.push({id:e.id,...e.data()})}),a}catch(e){throw console.error("Error getting trainer availability:",e),e}}static async generateBookingSlotsFromAvailability(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8;try{if(!l.db)throw Error("Firebase Firestore not initialized");let e=(0,o.wP)(l.db),a=new Date,i=new Date;i.setDate(a.getDate()+7*r);let s=new Date(a);for(;s.getDay()!==t.dayOfWeek;)s.setDate(s.getDate()+1);for(;s<=i;){let r=s.toISOString().split("T")[0],[a,i]=t.startTime.split(":").map(Number),[n,d]=t.endTime.split(":").map(Number),m=60*n+d-(60*a+i),u={trainerId:t.trainerId,traineeId:void 0,date:r,startTime:t.startTime,endTime:t.endTime,duration:m,status:"available",sessionType:t.sessionTypes[0]||"personal_training",isRecurring:!1,price:void 0,currency:"USD",location:t.location,isRemote:t.isRemote||!1,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},g=(0,o.H9)((0,o.rJ)(l.db,c));e.set(g,u),s.setDate(s.getDate()+7)}await e.commit()}catch(e){throw console.error("Error generating booking slots:",e),e}}static async bookTimeSlot(e,t){try{if(!l.db)throw Error("Firebase Firestore not initialized");let r=new Date().toISOString();if((await this.checkForConflicts(e,t.date,t.startTime,t.duration)).length>0)throw Error("Time slot conflicts with existing booking");let[a,i]=t.startTime.split(":").map(Number),s=new Date;s.setHours(a,i+t.duration);let n="".concat(s.getHours().toString().padStart(2,"0"),":").concat(s.getMinutes().toString().padStart(2,"0")),d={trainerId:e,traineeId:t.traineeId,date:t.date,startTime:t.startTime,endTime:n,duration:t.duration,status:"booked",sessionType:t.sessionType,isRecurring:t.isRecurring||!1,bookingNotes:t.notes,location:t.location,isRemote:t.isRemote,bookedAt:r,createdAt:r,updatedAt:r},m=await (0,o.gS)((0,o.rJ)(l.db,c),d);return t.isRecurring&&t.recurringPattern&&await this.createRecurringBooking(e,t),m.id}catch(e){throw console.error("Error booking time slot:",e),e}}static async getTrainerBookings(e,t,r){try{if(!l.db)throw Error("Firebase Firestore not initialized");let a=(0,o.P)((0,o.rJ)(l.db,c),(0,o._M)("trainerId","==",e),(0,o._M)("date",">=",t),(0,o._M)("date","<=",r),(0,o.My)("date","asc"),(0,o.My)("startTime","asc")),i=await (0,o.GG)(a),s=[];return i.forEach(e=>{s.push({id:e.id,...e.data()})}),s}catch(e){throw console.error("Error getting trainer bookings:",e),e}}static async getDaySchedule(e,t){try{let r,a,i=await this.getTrainerBookings(e,t,t),s=await this.getTrainerAvailability(e),n=new Date(t).getDay(),o=s.filter(e=>e.dayOfWeek===n),l=[],d=0,c=0;for(let e of o){let[t,s]=e.startTime.split(":").map(Number),[n,o]=e.endTime.split(":").map(Number);for(let e=t;e<n||e===n&&s<o;e++)for(let m=e===t?s:0;m<60&&(e!==n||!(m>=o));m+=30){let t="".concat(e.toString().padStart(2,"0"),":").concat(m.toString().padStart(2,"0")),s=m+30,n=s>=60?e+1:e,o=s>=60?s-60:s,u="".concat(n.toString().padStart(2,"0"),":").concat(o.toString().padStart(2,"0")),g=i.find(e=>e.startTime<=t&&e.endTime>t),h={start:t,end:u,isAvailable:!g,isBooked:!!g,sessionType:null==g?void 0:g.sessionType,traineeId:null==g?void 0:g.traineeId,bookingId:null==g?void 0:g.id};l.push(h),h.isAvailable?(d++,r||(r=t),a=t):c++}}return{date:t,timeSlots:l,totalAvailableSlots:d,totalBookedSlots:c,firstAvailableTime:r,lastAvailableTime:a}}catch(e){throw console.error("Error getting day schedule:",e),e}}static async createRecurringBooking(e,t){try{if(!l.db||!t.recurringPattern)throw Error("Firebase Firestore not initialized or no recurring pattern");let r=new Date().toISOString(),a={trainerId:e,traineeId:t.traineeId,pattern:t.recurringPattern.pattern,frequency:t.recurringPattern.frequency,daysOfWeek:[new Date(t.date).getDay()],startTime:t.startTime,endTime:"",duration:t.duration,startDate:t.date,endDate:t.recurringPattern.endDate,maxOccurrences:t.recurringPattern.maxOccurrences,sessionType:t.sessionType,title:"Recurring ".concat(t.sessionType),description:t.notes,generatedSlots:[],nextGenerationDate:new Date().toISOString(),isActive:!0,location:t.location,isRemote:t.isRemote,createdAt:r,updatedAt:r},[i,s]=t.startTime.split(":").map(Number),n=new Date;return n.setHours(i,s+t.duration),a.endTime="".concat(n.getHours().toString().padStart(2,"0"),":").concat(n.getMinutes().toString().padStart(2,"0")),(await (0,o.gS)((0,o.rJ)(l.db,"recurring_bookings"),a)).id}catch(e){throw console.error("Error creating recurring booking:",e),e}}static async checkForConflicts(e,t,r,a){try{if(!l.db)throw Error("Firebase Firestore not initialized");let[i,s]=r.split(":").map(Number),n=new Date;n.setHours(i,s+a);let d="".concat(n.getHours().toString().padStart(2,"0"),":").concat(n.getMinutes().toString().padStart(2,"0")),m=(0,o.P)((0,o.rJ)(l.db,c),(0,o._M)("trainerId","==",e),(0,o._M)("date","==",t),(0,o._M)("status","==","booked")),u=await (0,o.GG)(m),g=[];return u.forEach(e=>{let t={id:e.id,...e.data()};(r>=t.startTime&&r<t.endTime||d>t.startTime&&d<=t.endTime||r<=t.startTime&&d>=t.endTime)&&g.push(t)}),g}catch(e){throw console.error("Error checking for conflicts:",e),e}}static async generateScheduleStats(e,t){try{let r=new Date,a=new Date;switch(t){case"week":a.setDate(r.getDate()-7);break;case"month":a.setMonth(r.getMonth()-1);break;case"quarter":a.setMonth(r.getMonth()-3)}let i=await this.getTrainerBookings(e,a.toISOString().split("T")[0],r.toISOString().split("T")[0]),s=i.length,n=i.filter(e=>"booked"===e.status).length,o=i.filter(e=>"cancelled"===e.status).length,l=i.reduce((e,t)=>e+t.duration/60,0),d=(await this.getTrainerAvailability(e)).reduce((e,t)=>{let[r,a]=t.startTime.split(":").map(Number),[i,s]=t.endTime.split(":").map(Number);return e+(i+s/60-(r+a/60))},0)*("week"===t?1:"month"===t?4:12),c=i.reduce((e,t)=>e+(t.price||0),0);return{trainerId:e,period:t,totalAvailableHours:d,bookedHours:l,availableHours:d-l,utilizationRate:d>0?l/d*100:0,totalBookings:s,completedBookings:n,cancelledBookings:o,noShowBookings:0,totalRevenue:c,averageSessionValue:s>0?c/s:0,peakBookingHours:[],popularDays:[],popularTimes:[],generatedAt:new Date().toISOString()}}catch(e){throw console.error("Error generating schedule stats:",e),e}}static async getCalendarSettings(e){try{if(!l.db)throw Error("Firebase Firestore not initialized");let t=(0,o.H9)(l.db,m,e),r=await (0,o.x7)(t);if(r.exists())return{trainerId:e,...r.data()};return{trainerId:e,defaultView:"week",startHour:6,endHour:22,workingDays:[1,2,3,4,5],showWeekends:!0,showBlockedSlots:!0,showAvailableSlots:!0,timeSlotDuration:30,colorScheme:{personal_training:"#3B82F6",group_training:"#10B981",assessment:"#F59E0B",consultation:"#8B5CF6"},timezone:"America/New_York",updatedAt:new Date().toISOString()}}catch(e){throw console.error("Error getting calendar settings:",e),e}}static async updateCalendarSettings(e,t){try{if(!l.db)throw Error("Firebase Firestore not initialized");let r=(0,o.H9)(l.db,m,e);await (0,o.mZ)(r,{...t,updatedAt:new Date().toISOString()})}catch(e){throw console.error("Error updating calendar settings:",e),e}}static async cancelBooking(e,t){try{if(!l.db)throw Error("Firebase Firestore not initialized");let r=(0,o.H9)(l.db,c,e);await (0,o.mZ)(r,{status:"cancelled",cancellationReason:t,cancelledAt:new Date().toISOString(),updatedAt:new Date().toISOString()})}catch(e){throw console.error("Error cancelling booking:",e),e}}static async getAvailableSlots(e,t,r){try{let a=(await this.getDaySchedule(e,t)).timeSlots.filter(e=>e.isAvailable);if(r){let i=await this.getTrainerAvailability(e),s=new Date(t).getDay(),n=i.filter(e=>e.dayOfWeek===s&&e.sessionTypes.includes(r));n.length>0&&(a=a.filter(e=>n.some(t=>e.start>=t.startTime&&e.end<=t.endTime)))}return a}catch(e){throw console.error("Error getting available slots:",e),e}}}var g=r(5915);function h(){let{user:e}=(0,s.A)(),[t,r]=(0,i.useState)(new Date),[o,l]=(0,i.useState)("week"),[d,c]=(0,i.useState)([]),[m,h]=(0,i.useState)([]),[p,w]=(0,i.useState)([]),[v,f]=(0,i.useState)(!0),[S,j]=(0,i.useState)(null),[k,T]=(0,i.useState)(!1),[N,D]=(0,i.useState)(!1),[E,I]=(0,i.useState)(null);(0,i.useEffect)(()=>{e&&A()},[e,t]);let A=async()=>{try{f(!0),j(null);let r=new Date(t),a=new Date(t);"week"===o?(r.setDate(t.getDate()-t.getDay()),a.setDate(r.getDate()+6)):"month"===o?(r.setDate(1),a.setMonth(r.getMonth()+1,0)):a.setDate(r.getDate());let[i,s,n]=await Promise.all([u.getTrainerBookings(e.uid,r.toISOString().split("T")[0],a.toISOString().split("T")[0]),u.getTrainerAvailability(e.uid),g.g.getTraineesByTrainer(e.uid)]);c(i),h(s),w(n)}catch(e){console.error("Error loading schedule data:",e),j("Failed to load schedule data")}finally{f(!1)}},F=async t=>{try{await u.bookTimeSlot(e.uid,t),T(!1),I(null),A()}catch(e){console.error("Error creating booking:",e),j("Failed to create booking")}},O=async t=>{try{await u.createAvailabilitySlot(e.uid,t),D(!1),A()}catch(e){console.error("Error creating availability:",e),j("Failed to create availability")}},_=e=>{let a=new Date(t);"week"===o?a.setDate(t.getDate()+("next"===e?7:-7)):"month"===o?a.setMonth(t.getMonth()+("next"===e?1:-1)):a.setDate(t.getDate()+("next"===e?1:-1)),r(a)},C=()=>{let e=new Date(t);e.setDate(t.getDate()-t.getDay());let r=[];for(let t=0;t<7;t++){let a=new Date(e);a.setDate(e.getDate()+t),r.push(a)}return r};return e?(0,a.jsxs)(n.A,{currentPage:"schedule",children:[(0,a.jsx)("div",{className:"bg-white shadow-sm border-b",children:(0,a.jsxs)("div",{className:"px-6 py-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Schedule & Calendar"}),(0,a.jsx)("div",{className:"flex rounded-md shadow-sm",children:["day","week","month"].map(e=>(0,a.jsx)("button",{onClick:()=>l(e),className:"px-3 py-2 text-sm font-medium ".concat(o===e?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-50"," ").concat("day"===e?"rounded-l-md":"month"===e?"rounded-r-md":""," border border-gray-300"),children:e.charAt(0).toUpperCase()+e.slice(1)},e))})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("button",{onClick:()=>D(!0),className:"bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700",children:"Set Availability"}),(0,a.jsx)("button",{onClick:()=>T(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700",children:"Book Session"})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between mt-4",children:[(0,a.jsx)("button",{onClick:()=>_("prev"),className:"flex items-center px-3 py-2 text-sm bg-white border border-gray-300 rounded-md hover:bg-gray-50",children:"← Previous"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"month"===o?t.toLocaleDateString("en-US",{month:"long",year:"numeric"}):"week"===o?"".concat(C()[0].toLocaleDateString("en-US",{month:"short",day:"numeric"})," - ").concat(C()[6].toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})):t.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"})}),(0,a.jsx)("button",{onClick:()=>_("next"),className:"flex items-center px-3 py-2 text-sm bg-white border border-gray-300 rounded-md hover:bg-gray-50",children:"Next →"})]})]})}),S&&(0,a.jsx)("div",{className:"bg-red-50 border-l-4 border-red-400 p-4 mb-4",children:(0,a.jsx)("div",{className:"flex",children:(0,a.jsxs)("div",{className:"ml-3",children:[(0,a.jsx)("p",{className:"text-sm text-red-700",children:S}),(0,a.jsx)("button",{onClick:()=>j(null),className:"mt-2 text-sm text-red-600 hover:text-red-500",children:"Dismiss"})]})})}),(0,a.jsx)("div",{className:"p-6",children:v?(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("svg",{className:"animate-spin h-8 w-8 text-blue-600 mx-auto",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,a.jsx)("p",{className:"mt-2 text-gray-600",children:"Loading schedule..."})]})}):"week"===o?(0,a.jsx)(b,{weekDays:C(),timeSlots:(()=>{let e=[];for(let t=6;t<22;t++)for(let r=0;r<60;r+=30){let a="".concat(t.toString().padStart(2,"0"),":").concat(r.toString().padStart(2,"0"));e.push(a)}return e})(),onTimeSlotClick:(e,t)=>{I({date:e,time:t}),T(!0)},isSlotBooked:(e,t)=>d.some(r=>r.date===e&&r.startTime<=t&&r.endTime>t&&"booked"===r.status),isSlotAvailable:(e,t)=>{let r=new Date(e).getDay();return m.some(e=>e.dayOfWeek===r&&e.startTime<=t&&e.endTime>t&&e.isAvailable)},getBookingForSlot:(e,t)=>d.find(r=>r.date===e&&r.startTime<=t&&r.endTime>t&&"booked"===r.status)}):(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("p",{className:"text-gray-500",children:"Day and Month views coming soon!"}),(0,a.jsx)("p",{className:"text-sm text-gray-400 mt-2",children:"Currently showing Week view functionality"})]})}),k&&(0,a.jsx)(y,{isOpen:k,onClose:()=>{T(!1),I(null)},onSubmit:F,trainees:p,selectedTimeSlot:E}),N&&(0,a.jsx)(x,{isOpen:N,onClose:()=>D(!1),onSubmit:O})]}):(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("svg",{className:"animate-spin h-8 w-8 text-blue-600 mx-auto",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,a.jsx)("p",{className:"mt-2 text-gray-600",children:"Loading..."})]})})}function b(e){let{weekDays:t,timeSlots:r,onTimeSlotClick:i,isSlotBooked:s,isSlotAvailable:n,getBookingForSlot:o}=e;return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border overflow-hidden",children:[(0,a.jsxs)("div",{className:"grid grid-cols-8 border-b",children:[(0,a.jsx)("div",{className:"p-4 bg-gray-50 border-r"}),t.map((e,t)=>(0,a.jsx)("div",{className:"p-4 bg-gray-50 border-r last:border-r-0",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-500",children:e.toLocaleDateString("en-US",{weekday:"short"})}),(0,a.jsx)("div",{className:"text-lg font-semibold ".concat(e.toDateString()===new Date().toDateString()?"text-blue-600":"text-gray-900"),children:e.getDate()})]})},t))]}),(0,a.jsx)("div",{className:"max-h-96 overflow-y-auto",children:r.map(e=>(0,a.jsxs)("div",{className:"grid grid-cols-8 border-b border-gray-100 last:border-b-0",children:[(0,a.jsx)("div",{className:"p-2 bg-gray-50 border-r text-xs text-gray-500 text-center",children:e}),t.map((t,r)=>{let l=t.toISOString().split("T")[0],d=s(l,e),c=n(l,e),m=o(l,e);return(0,a.jsxs)("div",{onClick:()=>!d&&i(l,e),className:"p-2 border-r last:border-r-0 h-12 relative cursor-pointer transition-colors ".concat(d?"bg-blue-100 border-blue-200":c?"bg-green-50 hover:bg-green-100":"bg-gray-50 hover:bg-gray-100"),children:[d&&m&&(0,a.jsx)("div",{className:"absolute inset-1 bg-blue-600 text-white text-xs rounded p-1 flex items-center justify-center",children:(0,a.jsx)("span",{className:"truncate",children:m.sessionType})}),c&&!d&&(0,a.jsx)("div",{className:"absolute inset-1 border-2 border-dashed border-green-300 rounded"})]},r)})]},e))})]})}function y(e){let{isOpen:t,onClose:r,onSubmit:s,trainees:n,selectedTimeSlot:o}=e,[l,d]=(0,i.useState)({date:(null==o?void 0:o.date)||"",startTime:(null==o?void 0:o.time)||"",duration:60,sessionType:"personal_training",isRemote:!1,isRecurring:!1});return t?(0,a.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl p-6 w-full max-w-md",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Book Session"}),(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault(),l.traineeId&&l.date&&l.startTime&&s(l)},className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Trainee"}),(0,a.jsxs)("select",{value:l.traineeId||"",onChange:e=>d({...l,traineeId:e.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2",required:!0,children:[(0,a.jsx)("option",{value:"",children:"Select a trainee"}),n.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Session Type"}),(0,a.jsxs)("select",{value:l.sessionType||"",onChange:e=>d({...l,sessionType:e.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2",children:[(0,a.jsx)("option",{value:"personal_training",children:"Personal Training"}),(0,a.jsx)("option",{value:"group_training",children:"Group Training"}),(0,a.jsx)("option",{value:"assessment",children:"Assessment"}),(0,a.jsx)("option",{value:"consultation",children:"Consultation"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Duration (minutes)"}),(0,a.jsxs)("select",{value:l.duration||60,onChange:e=>d({...l,duration:parseInt(e.target.value)}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2",children:[(0,a.jsx)("option",{value:30,children:"30 minutes"}),(0,a.jsx)("option",{value:60,children:"60 minutes"}),(0,a.jsx)("option",{value:90,children:"90 minutes"}),(0,a.jsx)("option",{value:120,children:"2 hours"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Notes"}),(0,a.jsx)("textarea",{value:l.notes||"",onChange:e=>d({...l,notes:e.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2",rows:3})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"checkbox",id:"isRemote",checked:l.isRemote||!1,onChange:e=>d({...l,isRemote:e.target.checked}),className:"h-4 w-4 text-blue-600 border-gray-300 rounded"}),(0,a.jsx)("label",{htmlFor:"isRemote",className:"ml-2 block text-sm text-gray-900",children:"Remote session"})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[(0,a.jsx)("button",{type:"button",onClick:r,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-md hover:bg-gray-200",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700",children:"Book Session"})]})]})]})}):null}function x(e){let{isOpen:t,onClose:r,onSubmit:s}=e,[n,o]=(0,i.useState)({dayOfWeek:1,startTime:"09:00",endTime:"17:00",sessionTypes:["personal_training"],recurrenceType:"weekly",isRemote:!1});return t?(0,a.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl p-6 w-full max-w-md",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Set Availability"}),(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault(),s(n)},className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Day of Week"}),(0,a.jsx)("select",{value:n.dayOfWeek||1,onChange:e=>o({...n,dayOfWeek:parseInt(e.target.value)}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2",children:[{value:0,label:"Sunday"},{value:1,label:"Monday"},{value:2,label:"Tuesday"},{value:3,label:"Wednesday"},{value:4,label:"Thursday"},{value:5,label:"Friday"},{value:6,label:"Saturday"}].map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Start Time"}),(0,a.jsx)("input",{type:"time",value:n.startTime||"",onChange:e=>o({...n,startTime:e.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"End Time"}),(0,a.jsx)("input",{type:"time",value:n.endTime||"",onChange:e=>o({...n,endTime:e.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2",required:!0})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Session Types"}),(0,a.jsx)("div",{className:"mt-2 space-y-2",children:["personal_training","group_training","assessment","consultation"].map(e=>{var t;return(0,a.jsxs)("label",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"checkbox",checked:(null==(t=n.sessionTypes)?void 0:t.includes(e))||!1,onChange:t=>{let r=n.sessionTypes||[];t.target.checked?o({...n,sessionTypes:[...r,e]}):o({...n,sessionTypes:r.filter(t=>t!==e)})},className:"h-4 w-4 text-blue-600 border-gray-300 rounded"}),(0,a.jsx)("span",{className:"ml-2 text-sm text-gray-900 capitalize",children:e.replace("_"," ")})]},e)})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Notes"}),(0,a.jsx)("textarea",{value:n.notes||"",onChange:e=>o({...n,notes:e.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2",rows:3})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[(0,a.jsx)("button",{type:"button",onClick:r,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-md hover:bg-gray-200",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",className:"px-4 py-2 text-sm font-medium text-white bg-green-600 border border-transparent rounded-md hover:bg-green-700",children:"Set Availability"})]})]})]})}):null}},5915:(e,t,r)=>{"use strict";r.d(t,{g:()=>l});var a=r(9708),i=r(4585);let s="trainee_invitations",n="trainees";function o(){let e=new Uint8Array(32);return crypto.getRandomValues(e),Array.from(e,e=>e.toString(16).padStart(2,"0")).join("")}class l{static async inviteTrainee(e,t){try{if(!i.db)throw Error("Firebase Firestore not initialized");let l=(0,a.P)((0,a.rJ)(i.db,n),(0,a._M)("trainerId","==",e),(0,a._M)("email","==",t.email));if(!(await (0,a.GG)(l)).empty)throw Error("A trainee with this email already exists");let d=(0,a.P)((0,a.rJ)(i.db,s),(0,a._M)("trainerId","==",e),(0,a._M)("email","==",t.email),(0,a._M)("status","==","pending"));if(!(await (0,a.GG)(d)).empty)throw Error("An invitation is already pending for this email");let c=o(),m=new Date,u=new Date(m.getTime()+6048e5),g={trainerId:e,email:t.email,firstName:t.firstName,lastName:t.lastName,fitnessLevel:t.fitnessLevel,goals:t.goals||[],notes:t.notes,status:"pending",inviteToken:c,invitedAt:m.toISOString(),expiresAt:u.toISOString()},h=await (0,a.gS)((0,a.rJ)(i.db,s),g),b={trainerId:e,email:t.email,firstName:t.firstName,lastName:t.lastName,joinDate:m.toISOString(),status:"pending",fitnessLevel:t.fitnessLevel||"beginner",goals:t.goals||[],notes:t.notes,totalSessions:0,invitationId:h.id};await (0,a.gS)((0,a.rJ)(i.db,n),b);try{var r;let e=(null===i.j2||void 0===i.j2||null==(r=i.j2.currentUser)?void 0:r.displayName)||"Your Trainer";fetch("/api/email/invite",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({traineeEmail:t.email,trainerName:e,traineeFirstName:t.firstName,invitationToken:c})}).then(async e=>{if(!e.ok){let t=await e.text();console.warn("Invitation email API responded with non-OK:",t)}}).catch(e=>{console.warn("Invitation email API call failed:",e)})}catch(e){console.error("Error initiating invitation email:",e)}return h.id}catch(e){throw console.error("Error inviting trainee:",e),e}}static async getTraineesByTrainer(e){try{if(!i.db)throw Error("Firebase Firestore not initialized");let t=(0,a.P)((0,a.rJ)(i.db,n),(0,a._M)("trainerId","==",e),(0,a.My)("joinDate","desc")),r=await (0,a.GG)(t),s=[];return r.forEach(e=>{s.push({id:e.id,...e.data()})}),s}catch(e){throw console.error("Error getting trainees:",e),e}}static async getTraineeById(e){try{if(!i.db)throw Error("Firebase Firestore not initialized");let t=(0,a.H9)(i.db,n,e),r=await (0,a.x7)(t);if(r.exists())return{id:r.id,...r.data()};return null}catch(e){throw console.error("Error getting trainee:",e),e}}static async updateTrainee(e,t){try{if(!i.db)throw Error("Firebase Firestore not initialized");let r=(0,a.H9)(i.db,n,e);await (0,a.mZ)(r,{...t,updatedAt:new Date().toISOString()})}catch(e){throw console.error("Error updating trainee:",e),e}}static async deleteTrainee(e){try{if(!i.db)throw Error("Firebase Firestore not initialized");let t=(0,a.H9)(i.db,n,e),r=await (0,a.x7)(t);if(!r.exists())return;{let e=r.data(),n=e.trainerId,o=e.email;if(await (0,a.kd)(t),n&&o){let e=(0,a.P)((0,a.rJ)(i.db,s),(0,a._M)("trainerId","==",n),(0,a._M)("email","==",o)),t=await (0,a.GG)(e),r=[];t.forEach(e=>{r.push((0,a.kd)(e.ref))}),r.length>0&&await Promise.all(r)}}}catch(e){throw console.error("Error deleting trainee:",e),e}}static async getInvitationByToken(e){try{if(!i.db)throw Error("Firebase Firestore not initialized");let t=(0,a.P)((0,a.rJ)(i.db,s),(0,a._M)("inviteToken","==",e),(0,a._M)("status","==","pending")),r=await (0,a.GG)(t);if(r.empty)return null;let n=r.docs[0],o={id:n.id,...n.data()};if(new Date(o.expiresAt)<new Date)return await this.expireInvitation(o.id),null;return o}catch(e){throw console.error("Error getting invitation by token:",e),e}}static async acceptInvitation(e,t){try{if(!i.db)throw Error("Firebase Firestore not initialized");let r=(0,a.H9)(i.db,s,e);await (0,a.mZ)(r,{status:"accepted",acceptedAt:new Date().toISOString()});let o=(0,a.P)((0,a.rJ)(i.db,n),(0,a._M)("invitationId","==",e)),l=await (0,a.GG)(o);if(!l.empty){let e=l.docs[0],r=(0,a.H9)(i.db,n,e.id);await (0,a.mZ)(r,{userId:t,status:"active",updatedAt:new Date().toISOString()})}}catch(e){throw console.error("Error accepting invitation:",e),e}}static async expireInvitation(e){try{if(!i.db)throw Error("Firebase Firestore not initialized");let t=(0,a.H9)(i.db,s,e);await (0,a.mZ)(t,{status:"expired"})}catch(e){throw console.error("Error expiring invitation:",e),e}}static async resendInvitation(e){try{if(!i.db)throw Error("Firebase Firestore not initialized");let t=o(),r=new Date(Date.now()+6048e5),n=(0,a.H9)(i.db,s,e);return await (0,a.mZ)(n,{inviteToken:t,status:"pending",expiresAt:r.toISOString(),resentAt:new Date().toISOString()}),t}catch(e){throw console.error("Error resending invitation:",e),e}}static async getPendingInvitations(e){try{if(!i.db)throw Error("Firebase Firestore not initialized");let t=(0,a.P)((0,a.rJ)(i.db,s),(0,a._M)("trainerId","==",e),(0,a._M)("status","==","pending"),(0,a.My)("invitedAt","desc")),r=await (0,a.GG)(t),n=[];return r.forEach(e=>{n.push({id:e.id,...e.data()})}),n}catch(e){throw console.error("Error getting pending invitations:",e),e}}}}},e=>{e.O(0,[992,416,914,533,441,493,358],()=>e(e.s=4531)),_N_E=e.O()}]);