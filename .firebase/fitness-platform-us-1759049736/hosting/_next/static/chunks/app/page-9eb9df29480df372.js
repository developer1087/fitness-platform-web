(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{987:(e,t,r)=>{Promise.resolve().then(r.bind(r,9547))},5915:(e,t,r)=>{"use strict";r.d(t,{g:()=>l});var s=r(9708),i=r(4585);let n="trainee_invitations",a="trainees";function o(){let e=new Uint8Array(32);return crypto.getRandomValues(e),Array.from(e,e=>e.toString(16).padStart(2,"0")).join("")}class l{static async inviteTrainee(e,t){try{if(!i.db)throw Error("Firebase Firestore not initialized");let l=(0,s.P)((0,s.rJ)(i.db,a),(0,s._M)("trainerId","==",e),(0,s._M)("email","==",t.email));if(!(await (0,s.GG)(l)).empty)throw Error("A trainee with this email already exists");let d=(0,s.P)((0,s.rJ)(i.db,n),(0,s._M)("trainerId","==",e),(0,s._M)("email","==",t.email),(0,s._M)("status","==","pending"));if(!(await (0,s.GG)(d)).empty)throw Error("An invitation is already pending for this email");let c=o(),h=new Date,m=new Date(h.getTime()+6048e5),x={trainerId:e,email:t.email,firstName:t.firstName,lastName:t.lastName,fitnessLevel:t.fitnessLevel,goals:t.goals||[],notes:t.notes,status:"pending",inviteToken:c,invitedAt:h.toISOString(),expiresAt:m.toISOString()},g=await (0,s.gS)((0,s.rJ)(i.db,n),x),u={trainerId:e,email:t.email,firstName:t.firstName,lastName:t.lastName,joinDate:h.toISOString(),status:"pending",fitnessLevel:t.fitnessLevel||"beginner",goals:t.goals||[],notes:t.notes,totalSessions:0,invitationId:g.id};await (0,s.gS)((0,s.rJ)(i.db,a),u);try{var r;let e=(null===i.j2||void 0===i.j2||null==(r=i.j2.currentUser)?void 0:r.displayName)||"Your Trainer";fetch("/api/email/invite",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({traineeEmail:t.email,trainerName:e,traineeFirstName:t.firstName,invitationToken:c})}).then(async e=>{if(!e.ok){let t=await e.text();console.warn("Invitation email API responded with non-OK:",t)}}).catch(e=>{console.warn("Invitation email API call failed:",e)})}catch(e){console.error("Error initiating invitation email:",e)}return g.id}catch(e){throw console.error("Error inviting trainee:",e),e}}static async getTraineesByTrainer(e){try{if(!i.db)throw Error("Firebase Firestore not initialized");let t=(0,s.P)((0,s.rJ)(i.db,a),(0,s._M)("trainerId","==",e),(0,s.My)("joinDate","desc")),r=await (0,s.GG)(t),n=[];return r.forEach(e=>{n.push({id:e.id,...e.data()})}),n}catch(e){throw console.error("Error getting trainees:",e),e}}static async getTraineeById(e){try{if(!i.db)throw Error("Firebase Firestore not initialized");let t=(0,s.H9)(i.db,a,e),r=await (0,s.x7)(t);if(r.exists())return{id:r.id,...r.data()};return null}catch(e){throw console.error("Error getting trainee:",e),e}}static async updateTrainee(e,t){try{if(!i.db)throw Error("Firebase Firestore not initialized");let r=(0,s.H9)(i.db,a,e);await (0,s.mZ)(r,{...t,updatedAt:new Date().toISOString()})}catch(e){throw console.error("Error updating trainee:",e),e}}static async deleteTrainee(e){try{if(!i.db)throw Error("Firebase Firestore not initialized");let t=(0,s.H9)(i.db,a,e),r=await (0,s.x7)(t);if(!r.exists())return;{let e=r.data(),a=e.trainerId,o=e.email;if(await (0,s.kd)(t),a&&o){let e=(0,s.P)((0,s.rJ)(i.db,n),(0,s._M)("trainerId","==",a),(0,s._M)("email","==",o)),t=await (0,s.GG)(e),r=[];t.forEach(e=>{r.push((0,s.kd)(e.ref))}),r.length>0&&await Promise.all(r)}}}catch(e){throw console.error("Error deleting trainee:",e),e}}static async getInvitationByToken(e){try{if(!i.db)throw Error("Firebase Firestore not initialized");let t=(0,s.P)((0,s.rJ)(i.db,n),(0,s._M)("inviteToken","==",e),(0,s._M)("status","==","pending")),r=await (0,s.GG)(t);if(r.empty)return null;let a=r.docs[0],o={id:a.id,...a.data()};if(new Date(o.expiresAt)<new Date)return await this.expireInvitation(o.id),null;return o}catch(e){throw console.error("Error getting invitation by token:",e),e}}static async acceptInvitation(e,t){try{if(!i.db)throw Error("Firebase Firestore not initialized");let r=(0,s.H9)(i.db,n,e);await (0,s.mZ)(r,{status:"accepted",acceptedAt:new Date().toISOString()});let o=(0,s.P)((0,s.rJ)(i.db,a),(0,s._M)("invitationId","==",e)),l=await (0,s.GG)(o);if(!l.empty){let e=l.docs[0],r=(0,s.H9)(i.db,a,e.id);await (0,s.mZ)(r,{userId:t,status:"active",updatedAt:new Date().toISOString()})}}catch(e){throw console.error("Error accepting invitation:",e),e}}static async expireInvitation(e){try{if(!i.db)throw Error("Firebase Firestore not initialized");let t=(0,s.H9)(i.db,n,e);await (0,s.mZ)(t,{status:"expired"})}catch(e){throw console.error("Error expiring invitation:",e),e}}static async resendInvitation(e){try{if(!i.db)throw Error("Firebase Firestore not initialized");let t=o(),r=new Date(Date.now()+6048e5),a=(0,s.H9)(i.db,n,e);return await (0,s.mZ)(a,{inviteToken:t,status:"pending",expiresAt:r.toISOString(),resentAt:new Date().toISOString()}),t}catch(e){throw console.error("Error resending invitation:",e),e}}static async getPendingInvitations(e){try{if(!i.db)throw Error("Firebase Firestore not initialized");let t=(0,s.P)((0,s.rJ)(i.db,n),(0,s._M)("trainerId","==",e),(0,s._M)("status","==","pending"),(0,s.My)("invitedAt","desc")),r=await (0,s.GG)(t),a=[];return r.forEach(e=>{a.push({id:e.id,...e.data()})}),a}catch(e){throw console.error("Error getting pending invitations:",e),e}}}},9547:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>l});var s=r(5155),i=r(2115),n=r(8576),a=r(1914),o=r(5915);function l(){let{user:e,loading:t}=(0,n.A)(),[r,l]=(0,i.useState)({newTrainees:0,sessionsThisMonth:0,revenueThisMonth:0,totalTrainees:0,pendingPayments:0,todaySessions:0}),[d,c]=(0,i.useState)([]);return((0,i.useEffect)(()=>{let t=async()=>{if(null==e?void 0:e.uid)try{let t=await o.g.getTraineesByTrainer(e.uid),r=new Date,s=r.getMonth(),i=r.getFullYear(),n=t.filter(e=>{let t=new Date(e.joinDate);return t.getMonth()===s&&t.getFullYear()===i}).length;l({newTrainees:n,sessionsThisMonth:0,revenueThisMonth:0,totalTrainees:t.length,pendingPayments:0,todaySessions:0});let a=t.sort((e,t)=>new Date(t.joinDate).getTime()-new Date(e.joinDate).getTime()).slice(0,4).map(e=>({id:e.id,type:"trainee_joined",message:"".concat(e.firstName," ").concat(e.lastName," joined as trainee"),time:function(e){let t=new Date().getTime()-e.getTime(),r=Math.floor(t/864e5),s=Math.floor(t/36e5),i=Math.floor(t/6e4);return r>0?"".concat(r," day").concat(r>1?"s":""," ago"):s>0?"".concat(s," hour").concat(s>1?"s":""," ago"):i>0?"".concat(i," minute").concat(i>1?"s":""," ago"):"Just now"}(new Date(e.joinDate)),icon:"user",iconColor:"text-blue-600"}));c(a)}catch(e){console.error("Error loading dashboard data:",e),l({newTrainees:0,sessionsThisMonth:0,revenueThisMonth:0,totalTrainees:0,pendingPayments:0,todaySessions:0}),c([])}};e&&t()},[e]),t)?(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,s.jsx)("div",{className:"text-xl",children:"Loading..."})}):e?(0,s.jsxs)(a.A,{currentPage:"dashboard",children:[(0,s.jsx)("div",{className:"bg-white shadow-sm border-b",children:(0,s.jsx)("div",{className:"px-6 py-4",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Dashboard"}),(0,s.jsx)("div",{className:"text-sm text-gray-600",children:new Date().toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]})})}),(0,s.jsxs)("main",{className:"p-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[(0,s.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"p-2 bg-blue-50 rounded-lg",children:(0,s.jsx)("svg",{className:"h-6 w-6 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5 0a3 3 0 003-3V12a3 3 0 00-3-3h-4.5z"})})}),(0,s.jsxs)("div",{className:"ml-4",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"New Trainees This Month"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:r.newTrainees})]})]})}),(0,s.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"p-2 bg-green-50 rounded-lg",children:(0,s.jsx)("svg",{className:"h-6 w-6 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})})}),(0,s.jsxs)("div",{className:"ml-4",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Sessions This Month"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:r.sessionsThisMonth})]})]})}),(0,s.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"p-2 bg-yellow-50 rounded-lg",children:(0,s.jsx)("svg",{className:"h-6 w-6 text-yellow-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"})})}),(0,s.jsxs)("div",{className:"ml-4",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Revenue This Month"}),(0,s.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:["$",r.revenueThisMonth.toLocaleString()]})]})]})}),(0,s.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"p-2 bg-purple-50 rounded-lg",children:(0,s.jsx)("svg",{className:"h-6 w-6 text-purple-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})})}),(0,s.jsxs)("div",{className:"ml-4",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Trainees"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:r.totalTrainees})]})]})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8",children:[(0,s.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Today's Sessions"}),(0,s.jsx)("p",{className:"text-3xl font-bold text-gray-900",children:r.todaySessions}),(0,s.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Scheduled for today"})]}),(0,s.jsx)("div",{className:"p-3 bg-blue-50 rounded-lg",children:(0,s.jsx)("svg",{className:"h-8 w-8 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3a2 2 0 012-2h4a2 2 0 012 2v4m-6 12V7m6 0v14m-6-4h6"})})})]})}),(0,s.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Pending Payments"}),(0,s.jsx)("p",{className:"text-3xl font-bold text-gray-900",children:r.pendingPayments}),(0,s.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Require follow-up"})]}),(0,s.jsx)("div",{className:"p-3 bg-red-50 rounded-lg",children:(0,s.jsx)("svg",{className:"h-8 w-8 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})})]})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Quick Actions"}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("a",{href:"/trainees",className:"block w-full text-left p-3 bg-blue-50 hover:bg-blue-100 rounded-lg transition-colors",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("svg",{className:"h-5 w-5 text-blue-600 mr-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),(0,s.jsx)("span",{className:"font-medium text-gray-900",children:"Add New Trainee"})]})}),(0,s.jsx)("button",{className:"w-full text-left p-3 bg-green-50 hover:bg-green-100 rounded-lg transition-colors",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("svg",{className:"h-5 w-5 text-green-600 mr-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3a2 2 0 012-2h4a2 2 0 012 2v4m-6 12V7m6 0v14m-6-4h6"})}),(0,s.jsx)("span",{className:"font-medium text-gray-900",children:"Schedule Session"})]})}),(0,s.jsx)("button",{className:"w-full text-left p-3 bg-yellow-50 hover:bg-yellow-100 rounded-lg transition-colors",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("svg",{className:"h-5 w-5 text-yellow-600 mr-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),(0,s.jsx)("span",{className:"font-medium text-gray-900",children:"View Reports"})]})})]})]}),(0,s.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Recent Activity"}),(0,s.jsx)("div",{className:"space-y-4",children:d.map(e=>(0,s.jsxs)("div",{className:"flex items-start",children:[(0,s.jsx)("div",{className:"flex-shrink-0",children:(0,s.jsxs)("div",{className:"w-8 h-8 ".concat(e.iconColor.replace("text-","bg-").replace("-600","-100")," rounded-full flex items-center justify-center"),children:["user"===e.icon&&(0,s.jsx)("svg",{className:"w-4 h-4 ".concat(e.iconColor),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),"check"===e.icon&&(0,s.jsx)("svg",{className:"w-4 h-4 ".concat(e.iconColor),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"dollar"===e.icon&&(0,s.jsx)("svg",{className:"w-4 h-4 ".concat(e.iconColor),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"})}),"calendar"===e.icon&&(0,s.jsx)("svg",{className:"w-4 h-4 ".concat(e.iconColor),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3a2 2 0 012-2h4a2 2 0 012 2v4m-6 12V7m6 0v14m-6-4h6"})})]})}),(0,s.jsxs)("div",{className:"ml-3",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-900",children:e.message}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:e.time})]})]},e.id))})]})]})]})]}):(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,s.jsxs)("div",{className:"text-center max-w-md mx-auto p-8",children:[(0,s.jsx)("h1",{className:"text-4xl font-bold mb-8 text-gray-800",children:"Welcome to Fitness Platform"}),(0,s.jsx)("p",{className:"text-xl text-gray-600 mb-8",children:"Track your fitness journey with our comprehensive platform"}),(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[(0,s.jsx)("a",{href:"/auth/login",className:"bg-blue-600 text-white px-6 py-3 rounded-md hover:bg-blue-700 transition-colors inline-block",children:"Sign In"}),(0,s.jsx)("a",{href:"/auth/signup",className:"bg-green-600 text-white px-6 py-3 rounded-md hover:bg-green-700 transition-colors inline-block",children:"Get Started"})]})]})})}}},e=>{e.O(0,[992,416,914,533,441,493,358],()=>e(e.s=987)),_N_E=e.O()}]);