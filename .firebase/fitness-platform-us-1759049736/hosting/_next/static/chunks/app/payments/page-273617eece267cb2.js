(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[188],{758:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>g});var a=r(5155),i=r(2115),s=r(8576),n=r(1914),l=r(9708),d=r(4585);let o="payment_accounts",c="payment_methods",m="invoices",x="payments",u="payment_settings";class h{static async setupPaymentAccount(e,t){try{if(!d.db)throw Error("Firebase Firestore not initialized");let r=new Date().toISOString(),a=await this.getPaymentAccount(e);if(a){let e=(0,l.H9)(d.db,o,a.id);return await (0,l.mZ)(e,{...t,updatedAt:r}),a.id}{let a={trainerId:e,accountType:t.accountType||"individual",businessName:t.businessName,taxId:t.taxId,payoutSchedule:t.payoutSchedule||"weekly",minimumPayoutAmount:t.minimumPayoutAmount||25,currency:t.currency||"USD",isVerified:!1,isActive:!0,verificationStatus:"pending",platformFeePercentage:5,processingFeePercentage:2.9,createdAt:r,updatedAt:r};return(await (0,l.gS)((0,l.rJ)(d.db,o),a)).id}}catch(e){throw console.error("Error setting up payment account:",e),e}}static async getPaymentAccount(e){try{if(!d.db)throw Error("Firebase Firestore not initialized");let t=(0,l.P)((0,l.rJ)(d.db,o),(0,l._M)("trainerId","==",e),(0,l.AB)(1)),r=await (0,l.GG)(t);if(!r.empty){let e=r.docs[0];return{id:e.id,...e.data()}}return null}catch(e){throw console.error("Error getting payment account:",e),e}}static async createInvoice(e,t){try{if(!d.db)throw Error("Firebase Firestore not initialized");let r=new Date().toISOString(),a=await this.getPaymentSettings(e),i=await this.generateInvoiceNumber(e),s=t.lineItems.reduce((e,t)=>e+t.quantity*t.unitPrice,0),n=s*(((null==a?void 0:a.taxRate)||0)/100),o={trainerId:e,traineeId:t.traineeId,invoiceNumber:i,title:t.title,description:t.description,subtotal:s,taxAmount:n,platformFee:0,processingFee:0,totalAmount:s+n,currency:(null==a?void 0:a.currency)||"USD",lineItems:t.lineItems.map((e,t)=>({id:"".concat(Date.now(),"-").concat(t),description:e.description,quantity:e.quantity,unitPrice:e.unitPrice,totalPrice:e.quantity*e.unitPrice,sessionId:e.sessionId,isTaxable:!0,taxRate:(null==a?void 0:a.taxRate)||0,taxAmount:e.quantity*e.unitPrice*(((null==a?void 0:a.taxRate)||0)/100)})),status:"draft",paymentStatus:"unpaid",issueDate:r.split("T")[0],dueDate:t.dueDate,paymentTerms:t.paymentTerms,notes:t.notes,isRecurring:t.isRecurring,recurringFrequency:t.recurringFrequency,sessionIds:t.lineItems.map(e=>e.sessionId).filter(Boolean),createdAt:r,updatedAt:r};return(await (0,l.gS)((0,l.rJ)(d.db,m),o)).id}catch(e){throw console.error("Error creating invoice:",e),e}}static async getTrainerInvoices(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{if(!d.db)throw Error("Firebase Firestore not initialized");let r=(0,l.P)((0,l.rJ)(d.db,m),(0,l._M)("trainerId","==",e),(0,l.My)("createdAt","desc"));t.status&&(r=(0,l.P)(r,(0,l._M)("status","==",t.status))),t.limit&&(r=(0,l.P)(r,(0,l.AB)(t.limit)));let a=await (0,l.GG)(r),i=[];return a.forEach(e=>{i.push({id:e.id,...e.data()})}),i}catch(e){throw console.error("Error getting trainer invoices:",e),e}}static async getInvoice(e){try{if(!d.db)throw Error("Firebase Firestore not initialized");let t=(0,l.H9)(d.db,m,e),r=await (0,l.x7)(t);if(r.exists())return{id:r.id,...r.data()};return null}catch(e){throw console.error("Error getting invoice:",e),e}}static async sendInvoice(e){try{if(!d.db)throw Error("Firebase Firestore not initialized");let t=(0,l.H9)(d.db,m,e);await (0,l.mZ)(t,{status:"sent",sentDate:new Date().toISOString(),updatedAt:new Date().toISOString()}),console.log("Invoice sent (email integration needed)")}catch(e){throw console.error("Error sending invoice:",e),e}}static async processPayment(e,t){try{if(!d.db)throw Error("Firebase Firestore not initialized");let r=new Date().toISOString(),a=await this.getPaymentAccount(e);if(!a)throw Error("Payment account not found");let i=t.amount*(a.platformFeePercentage/100),s=t.amount*(a.processingFeePercentage/100),n=t.amount-i-s,o=Math.random()>.1?"succeeded":"failed",c={trainerId:e,traineeId:t.traineeId,invoiceId:t.invoiceId,amount:t.amount,currency:a.currency,paymentMethodId:t.paymentMethodId,status:o,failureReason:"failed"===o?"Insufficient funds":void 0,stripePaymentIntentId:"pi_mock_".concat(Date.now()),externalReference:"ref_".concat(Date.now()),platformFee:i,processingFee:s,netAmount:n,initiatedAt:r,processedAt:"succeeded"===o?r:void 0,failedAt:"failed"===o?r:void 0,isRefunded:!1,description:t.description,receiptUrl:"succeeded"===o?"https://mock-receipts.com/".concat(Date.now()):void 0,receiptNumber:"succeeded"===o?"RCP-".concat(Date.now()):void 0,createdAt:r,updatedAt:r},m=await (0,l.gS)((0,l.rJ)(d.db,x),c);return t.invoiceId&&"succeeded"===o&&await this.updateInvoicePaymentStatus(t.invoiceId,"paid"),m.id}catch(e){throw console.error("Error processing payment:",e),e}}static async updateInvoicePaymentStatus(e,t){try{if(!d.db)throw Error("Firebase Firestore not initialized");let r=(0,l.H9)(d.db,m,e),a={paymentStatus:t,updatedAt:new Date().toISOString()};"paid"===t&&(a.paidDate=new Date().toISOString(),a.status="paid"),await (0,l.mZ)(r,a)}catch(e){throw console.error("Error updating invoice payment status:",e),e}}static async addPaymentMethod(e,t){try{var r,a;if(!d.db)throw Error("Firebase Firestore not initialized");let i=new Date().toISOString(),s={traineeId:e,type:t.type,provider:"stripe",cardLast4:"card"===t.type?null==(r=t.cardNumber)?void 0:r.slice(-4):void 0,cardBrand:"card"===t.type?"visa":void 0,cardExpMonth:t.cardExpMonth,cardExpYear:t.cardExpYear,bankName:"bank_account"===t.type?"Mock Bank":void 0,accountLast4:"bank_account"===t.type?null==(a=t.accountNumber)?void 0:a.slice(-4):void 0,stripePaymentMethodId:"pm_mock_".concat(Date.now()),isDefault:!1,isActive:!0,isVerified:!0,nickname:t.nickname,billingAddress:t.billingAddress,createdAt:i,updatedAt:i};return(await (0,l.gS)((0,l.rJ)(d.db,c),s)).id}catch(e){throw console.error("Error adding payment method:",e),e}}static async getTraineePaymentMethods(e){try{if(!d.db)throw Error("Firebase Firestore not initialized");let t=(0,l.P)((0,l.rJ)(d.db,c),(0,l._M)("traineeId","==",e),(0,l._M)("isActive","==",!0),(0,l.My)("isDefault","desc"),(0,l.My)("createdAt","desc")),r=await (0,l.GG)(t),a=[];return r.forEach(e=>{a.push({id:e.id,...e.data()})}),a}catch(e){throw console.error("Error getting payment methods:",e),e}}static async generateFinancialReport(e,t,r,a,i){try{let s,n;if(!d.db)throw Error("Firebase Firestore not initialized");let o=new Date;if(a&&i)s=a,n=i;else{n=o.toISOString().split("T")[0];let e=new Date(o);switch(r){case"week":e.setDate(o.getDate()-7);break;case"month":e.setMonth(o.getMonth()-1);break;case"quarter":e.setMonth(o.getMonth()-3);break;case"year":e.setFullYear(o.getFullYear()-1)}s=e.toISOString().split("T")[0]}let c=await this.getTrainerPayments(e,s,n),m=c.filter(e=>"succeeded"===e.status),x=m.reduce((e,t)=>e+t.amount,0),u=m.length,h=m.reduce((e,t)=>e+t.platformFee,0),p=m.reduce((e,t)=>e+t.processingFee,0),g=x-h-p,y=c.filter(e=>e.isRefunded).reduce((e,t)=>e+(t.refundAmount||0),0),v={id:"",trainerId:e,reportType:t,period:r,startDate:s,endDate:n,totalRevenue:x,totalSessions:u,averageSessionValue:u>0?x/u:0,revenueBySessionType:{},grossIncome:x,platformFees:h,processingFees:p,netIncome:g,totalPayments:c.length,successfulPayments:m.length,failedPayments:c.filter(e=>"failed"===e.status).length,refundedAmount:y,taxableIncome:g,topSessionTypes:[],topTrainees:[],generatedAt:new Date().toISOString()},b=await (0,l.gS)((0,l.rJ)(d.db,"financial_reports"),v);return v.id=b.id,v}catch(e){throw console.error("Error generating financial report:",e),e}}static async getTrainerPayments(e,t,r){try{if(!d.db)throw Error("Firebase Firestore not initialized");let a=(0,l.P)((0,l.rJ)(d.db,x),(0,l._M)("trainerId","==",e),(0,l.My)("createdAt","desc")),i=await (0,l.GG)(a),s=[];return i.forEach(e=>{s.push({id:e.id,...e.data()})}),(t||r)&&(s=s.filter(e=>{let a=e.createdAt.split("T")[0];return(!t||!(a<t))&&(!r||!(a>r))})),s}catch(e){throw console.error("Error getting trainer payments:",e),e}}static async getPaymentSettings(e){try{if(!d.db)throw Error("Firebase Firestore not initialized");let t=(0,l.H9)(d.db,u,e),r=await (0,l.x7)(t);if(r.exists())return{trainerId:e,...r.data()};return{trainerId:e,defaultSessionRates:{personal_training:100,group_training:50,assessment:150,consultation:75},currency:"USD",taxRate:8.25,defaultPaymentTerms:"Net 15",latePaymentFee:25,latePaymentFeeType:"flat",invoicePrefix:"INV-",nextInvoiceNumber:1,autoInvoiceAfterSession:!1,paymentDueDays:15,sendInvoiceReminders:!0,reminderDaysBefore:[7,3,1],sendPaymentConfirmations:!0,allowPartialRefunds:!0,updatedAt:new Date().toISOString()}}catch(e){throw console.error("Error getting payment settings:",e),e}}static async updatePaymentSettings(e,t){try{if(!d.db)throw Error("Firebase Firestore not initialized");let r=(0,l.H9)(d.db,u,e);await (0,l.mZ)(r,{...t,updatedAt:new Date().toISOString()})}catch(e){throw console.error("Error updating payment settings:",e),e}}static async generateInvoiceNumber(e){try{let t=await this.getPaymentSettings(e),r=(null==t?void 0:t.invoicePrefix)||"INV-",a=(null==t?void 0:t.nextInvoiceNumber)||1;return t&&await this.updatePaymentSettings(e,{nextInvoiceNumber:a+1}),"".concat(r).concat(a.toString().padStart(6,"0"))}catch(e){throw console.error("Error generating invoice number:",e),e}}static async calculatePlatformRevenue(e,t){try{if(!d.db)throw Error("Firebase Firestore not initialized");let r=(0,l.P)((0,l.rJ)(d.db,x),(0,l._M)("status","==","succeeded"),(0,l.My)("createdAt","asc")),a=await (0,l.GG)(r),i=0,s=0,n=0;return a.forEach(r=>{let a=r.data(),l=a.createdAt.split("T")[0];l>=e&&l<=t&&(i+=a.amount,s+=a.platformFee,n+=a.processingFee)}),{totalRevenue:i,platformFees:s,processingFees:n}}catch(e){throw console.error("Error calculating platform revenue:",e),e}}static async getPaymentStats(e){try{let t=await this.getTrainerPayments(e),r=t.filter(e=>"succeeded"===e.status),a=r.reduce((e,t)=>e+t.amount,0),i=t.length,s=r.length>0?a/r.length:0,n=i>0?r.length/i*100:0;return{totalRevenue:a,totalPayments:i,averagePayment:s,successRate:n}}catch(e){throw console.error("Error getting payment stats:",e),e}}}var p=r(5915);function g(){let{user:e}=(0,s.A)(),[t,r]=(0,i.useState)("overview"),[l,d]=(0,i.useState)([]),[o,c]=(0,i.useState)([]),[m,x]=(0,i.useState)(null),[u,g]=(0,i.useState)([]),[j,N]=(0,i.useState)(!0),[I,S]=(0,i.useState)(null),[P,F]=(0,i.useState)(!1),[A,E]=(0,i.useState)(null);(0,i.useEffect)(()=>{e&&k()},[e]);let k=async()=>{try{N(!0),S(null);let[t,r,a,i]=await Promise.all([h.getPaymentAccount(e.uid),h.getTrainerInvoices(e.uid,{limit:50}),h.getTrainerPayments(e.uid),p.g.getTraineesByTrainer(e.uid)]);x(t),d(r),c(a),g(i)}catch(e){console.error("Error loading payment data:",e),S("Failed to load payment data")}finally{N(!1)}},D=async t=>{try{await h.createInvoice(e.uid,t),F(!1),k()}catch(e){console.error("Error creating invoice:",e),S("Failed to create invoice")}},M=async e=>{try{await h.sendInvoice(e),k()}catch(e){console.error("Error sending invoice:",e),S("Failed to send invoice")}},T=o.filter(e=>"succeeded"===e.status).reduce((e,t)=>e+t.amount,0),R=o.filter(e=>"succeeded"===e.status&&new Date(e.createdAt).getMonth()===new Date().getMonth()).reduce((e,t)=>e+t.amount,0),C=l.filter(e=>"unpaid"===e.paymentStatus).reduce((e,t)=>e+t.totalAmount,0),z=l.filter(e=>"unpaid"===e.paymentStatus&&new Date(e.dueDate)<new Date).reduce((e,t)=>e+t.totalAmount,0);return e?(0,a.jsxs)(n.A,{currentPage:"payments",children:[(0,a.jsx)("div",{className:"bg-white shadow-sm border-b",children:(0,a.jsxs)("div",{className:"px-6 py-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Payments & Billing"}),(0,a.jsx)("button",{onClick:()=>F(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700",children:"Create Invoice"})]}),(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)("nav",{className:"flex space-x-8",children:[{key:"overview",label:"Overview"},{key:"invoices",label:"Invoices"},{key:"payments",label:"Payments"},{key:"reports",label:"Reports"}].map(e=>(0,a.jsx)("button",{onClick:()=>r(e.key),className:"py-2 px-1 border-b-2 font-medium text-sm ".concat(t===e.key?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:e.label},e.key))})})]})}),I&&(0,a.jsx)("div",{className:"bg-red-50 border-l-4 border-red-400 p-4 mb-4",children:(0,a.jsx)("div",{className:"flex",children:(0,a.jsxs)("div",{className:"ml-3",children:[(0,a.jsx)("p",{className:"text-sm text-red-700",children:I}),(0,a.jsx)("button",{onClick:()=>S(null),className:"mt-2 text-sm text-red-600 hover:text-red-500",children:"Dismiss"})]})})}),(0,a.jsx)("div",{className:"p-6",children:j?(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("svg",{className:"animate-spin h-8 w-8 text-blue-600 mx-auto",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,a.jsx)("p",{className:"mt-2 text-gray-600",children:"Loading payment data..."})]})}):(0,a.jsxs)("div",{className:"max-w-6xl mx-auto",children:["overview"===t&&(0,a.jsx)(y,{totalRevenue:T,thisMonthRevenue:R,pendingAmount:C,overdueAmount:z,recentInvoices:l.slice(0,5),recentPayments:o.slice(0,5),account:m}),"invoices"===t&&(0,a.jsx)(v,{invoices:l,onSendInvoice:M,onViewInvoice:e=>E(e)}),"payments"===t&&(0,a.jsx)(b,{payments:o}),"reports"===t&&(0,a.jsx)(w,{trainerId:e.uid})]})}),P&&(0,a.jsx)(f,{isOpen:P,onClose:()=>F(!1),onSubmit:D,trainees:u})]}):(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("svg",{className:"animate-spin h-8 w-8 text-blue-600 mx-auto",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,a.jsx)("p",{className:"mt-2 text-gray-600",children:"Loading..."})]})})}function y(e){let{totalRevenue:t,thisMonthRevenue:r,pendingAmount:i,overdueAmount:s,recentInvoices:n,recentPayments:l,account:d}=e;return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,a.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:(0,a.jsx)("svg",{className:"w-4 h-4 text-green-600",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M4 4a2 2 0 00-2 2v4a2 2 0 002 2V6h10a2 2 0 00-2-2H4zm2 6a2 2 0 012-2h8a2 2 0 012 2v4a2 2 0 01-2 2H8a2 2 0 01-2-2v-4zm6 4a2 2 0 100-4 2 2 0 000 4z",clipRule:"evenodd"})})})}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Total Revenue"}),(0,a.jsxs)("p",{className:"text-2xl font-semibold text-gray-900",children:["$",t.toFixed(2)]})]})]})}),(0,a.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:(0,a.jsx)("svg",{className:"w-4 h-4 text-blue-600",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v.092a4.535 4.535 0 00-1.676.662C6.602 6.234 6 7.009 6 8c0 .99.602 1.765 1.324 2.246.48.32 1.054.545 1.676.662v1.941c-.391-.127-.68-.317-.843-.504a1 1 0 10-1.51 1.31c.562.649 1.413 1.076 2.353 1.253V15a1 1 0 102 0v-.092a4.535 4.535 0 001.676-.662C13.398 13.766 14 12.991 14 12c0-.99-.602-1.765-1.324-2.246A4.535 4.535 0 0011 9.092V7.151c.391.127.68.317.843.504a1 1 0 101.511-1.31c-.563-.649-1.413-1.076-2.354-1.253V5z",clipRule:"evenodd"})})})}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"This Month"}),(0,a.jsxs)("p",{className:"text-2xl font-semibold text-gray-900",children:["$",r.toFixed(2)]})]})]})}),(0,a.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)("div",{className:"w-8 h-8 bg-yellow-100 rounded-full flex items-center justify-center",children:(0,a.jsx)("svg",{className:"w-4 h-4 text-yellow-600",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z",clipRule:"evenodd"})})})}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Pending"}),(0,a.jsxs)("p",{className:"text-2xl font-semibold text-gray-900",children:["$",i.toFixed(2)]})]})]})}),(0,a.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)("div",{className:"w-8 h-8 bg-red-100 rounded-full flex items-center justify-center",children:(0,a.jsx)("svg",{className:"w-4 h-4 text-red-600",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})})}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Overdue"}),(0,a.jsxs)("p",{className:"text-2xl font-semibold text-gray-900",children:["$",s.toFixed(2)]})]})]})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border",children:[(0,a.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Recent Invoices"})}),(0,a.jsx)("div",{className:"p-6",children:0===n.length?(0,a.jsx)("p",{className:"text-gray-500 text-center py-4",children:"No invoices yet"}):(0,a.jsx)("div",{className:"space-y-3",children:n.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900",children:e.invoiceNumber}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:e.title})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("p",{className:"text-sm font-medium text-gray-900",children:["$",e.totalAmount.toFixed(2)]}),(0,a.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-medium rounded-full ".concat("paid"===e.paymentStatus?"bg-green-100 text-green-800":"unpaid"===e.paymentStatus?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"),children:e.paymentStatus})]})]},e.id))})})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border",children:[(0,a.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Recent Payments"})}),(0,a.jsx)("div",{className:"p-6",children:0===l.length?(0,a.jsx)("p",{className:"text-gray-500 text-center py-4",children:"No payments yet"}):(0,a.jsx)("div",{className:"space-y-3",children:l.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-sm font-medium text-gray-900",children:["Payment #",e.id.slice(-6)]}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:new Date(e.createdAt).toLocaleDateString()})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("p",{className:"text-sm font-medium text-gray-900",children:["$",e.amount.toFixed(2)]}),(0,a.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-medium rounded-full ".concat("succeeded"===e.status?"bg-green-100 text-green-800":"failed"===e.status?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"),children:e.status})]})]},e.id))})})]})]}),!d&&(0,a.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)("svg",{className:"h-5 w-5 text-yellow-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),(0,a.jsxs)("div",{className:"ml-3",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-yellow-800",children:"Payment Account Setup Required"}),(0,a.jsx)("div",{className:"mt-2 text-sm text-yellow-700",children:(0,a.jsx)("p",{children:"Set up your payment account to start accepting payments and managing invoices."})})]})]})})]})}function v(e){let{invoices:t,onSendInvoice:r,onViewInvoice:i}=e;return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border",children:[(0,a.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"All Invoices"})}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Invoice"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Client"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Due Date"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.invoiceNumber}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:e.title})]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.traineeId}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["$",e.totalAmount.toFixed(2)]}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-medium rounded-full ".concat("paid"===e.paymentStatus?"bg-green-100 text-green-800":"unpaid"===e.paymentStatus?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"),children:e.paymentStatus})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:new Date(e.dueDate).toLocaleDateString()}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("button",{onClick:()=>i(e),className:"text-blue-600 hover:text-blue-900",children:"View"}),"draft"===e.status&&(0,a.jsx)("button",{onClick:()=>r(e.id),className:"text-green-600 hover:text-green-900",children:"Send"})]})})]},e.id))})]})})]})}function b(e){let{payments:t}=e;return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border",children:[(0,a.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"All Payments"})}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Payment ID"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Invoice"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:["#",e.id.slice(-8)]}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["$",e.amount.toFixed(2)]}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-medium rounded-full ".concat("succeeded"===e.status?"bg-green-100 text-green-800":"failed"===e.status?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"),children:e.status})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:new Date(e.createdAt).toLocaleDateString()}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.invoiceId?"#".concat(e.invoiceId.slice(-6)):"N/A"})]},e.id))})]})})]})}function w(e){let{trainerId:t}=e,[r,s]=(0,i.useState)("revenue"),[n,l]=(0,i.useState)("month"),[d,o]=(0,i.useState)(null),[c,m]=(0,i.useState)(!1),x=async()=>{try{m(!0);let e=await h.generateFinancialReport(t,r,n);o(e)}catch(e){console.error("Error generating report:",e)}finally{m(!1)}};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Generate Financial Report"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Report Type"}),(0,a.jsxs)("select",{value:r,onChange:e=>s(e.target.value),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2",children:[(0,a.jsx)("option",{value:"revenue",children:"Revenue Report"}),(0,a.jsx)("option",{value:"comprehensive",children:"Comprehensive Report"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Period"}),(0,a.jsxs)("select",{value:n,onChange:e=>l(e.target.value),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2",children:[(0,a.jsx)("option",{value:"month",children:"Last Month"}),(0,a.jsx)("option",{value:"quarter",children:"Last Quarter"}),(0,a.jsx)("option",{value:"year",children:"Last Year"})]})]}),(0,a.jsx)("div",{className:"flex items-end",children:(0,a.jsx)("button",{onClick:x,disabled:c,className:"w-full bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 disabled:opacity-50",children:c?"Generating...":"Generate Report"})})]})]}),d&&(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[(0,a.jsxs)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:[r.charAt(0).toUpperCase()+r.slice(1)," Report"]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("div",{className:"text-2xl font-bold text-gray-900",children:["$",d.totalRevenue.toFixed(2)]}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"Total Revenue"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:d.totalSessions}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"Total Sessions"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("div",{className:"text-2xl font-bold text-gray-900",children:["$",d.averageSessionValue.toFixed(2)]}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"Average Session Value"})]})]})]})]})}function f(e){var t;let{isOpen:r,onClose:s,onSubmit:n,trainees:l}=e,[d,o]=(0,i.useState)({title:"",dueDate:new Date(Date.now()+1296e6).toISOString().split("T")[0],paymentTerms:"Net 15",lineItems:[{description:"",quantity:1,unitPrice:0}],isRecurring:!1}),c=(e,t,r)=>{let a=[...d.lineItems||[]];a[e]={...a[e],[t]:r},o({...d,lineItems:a})};return r?(0,a.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Create Invoice"}),(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault(),d.traineeId&&d.title&&d.lineItems&&n(d)},className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Client"}),(0,a.jsxs)("select",{value:d.traineeId||"",onChange:e=>o({...d,traineeId:e.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2",required:!0,children:[(0,a.jsx)("option",{value:"",children:"Select a client"}),l.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Due Date"}),(0,a.jsx)("input",{type:"date",value:d.dueDate||"",onChange:e=>o({...d,dueDate:e.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2",required:!0})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Invoice Title"}),(0,a.jsx)("input",{type:"text",value:d.title||"",onChange:e=>o({...d,title:e.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2",placeholder:"e.g., Personal Training Sessions - November 2024",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Line Items"}),null==(t=d.lineItems)?void 0:t.map((e,t)=>(0,a.jsxs)("div",{className:"grid grid-cols-6 gap-2 mb-2",children:[(0,a.jsx)("input",{type:"text",placeholder:"Description",value:e.description,onChange:e=>c(t,"description",e.target.value),className:"col-span-3 border border-gray-300 rounded-md px-3 py-2",required:!0}),(0,a.jsx)("input",{type:"number",placeholder:"Qty",value:e.quantity,onChange:e=>c(t,"quantity",parseInt(e.target.value)),className:"border border-gray-300 rounded-md px-3 py-2",min:"1",required:!0}),(0,a.jsx)("input",{type:"number",placeholder:"Price",value:e.unitPrice,onChange:e=>c(t,"unitPrice",parseFloat(e.target.value)),className:"border border-gray-300 rounded-md px-3 py-2",min:"0",step:"0.01",required:!0}),(0,a.jsx)("button",{type:"button",onClick:()=>(e=>{var t;let r=(null==(t=d.lineItems)?void 0:t.filter((t,r)=>r!==e))||[];o({...d,lineItems:r})})(t),className:"text-red-600 hover:text-red-800",children:"\xd7"})]},t)),(0,a.jsx)("button",{type:"button",onClick:()=>{o({...d,lineItems:[...d.lineItems||[],{description:"",quantity:1,unitPrice:0}]})},className:"text-blue-600 hover:text-blue-800 text-sm",children:"+ Add Line Item"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Notes"}),(0,a.jsx)("textarea",{value:d.notes||"",onChange:e=>o({...d,notes:e.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2",rows:3})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[(0,a.jsx)("button",{type:"button",onClick:s,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-md hover:bg-gray-200",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700",children:"Create Invoice"})]})]})]})}):null}},5915:(e,t,r)=>{"use strict";r.d(t,{g:()=>d});var a=r(9708),i=r(4585);let s="trainee_invitations",n="trainees";function l(){let e=new Uint8Array(32);return crypto.getRandomValues(e),Array.from(e,e=>e.toString(16).padStart(2,"0")).join("")}class d{static async inviteTrainee(e,t){try{if(!i.db)throw Error("Firebase Firestore not initialized");let d=(0,a.P)((0,a.rJ)(i.db,n),(0,a._M)("trainerId","==",e),(0,a._M)("email","==",t.email));if(!(await (0,a.GG)(d)).empty)throw Error("A trainee with this email already exists");let o=(0,a.P)((0,a.rJ)(i.db,s),(0,a._M)("trainerId","==",e),(0,a._M)("email","==",t.email),(0,a._M)("status","==","pending"));if(!(await (0,a.GG)(o)).empty)throw Error("An invitation is already pending for this email");let c=l(),m=new Date,x=new Date(m.getTime()+6048e5),u={trainerId:e,email:t.email,firstName:t.firstName,lastName:t.lastName,fitnessLevel:t.fitnessLevel,goals:t.goals||[],notes:t.notes,status:"pending",inviteToken:c,invitedAt:m.toISOString(),expiresAt:x.toISOString()},h=await (0,a.gS)((0,a.rJ)(i.db,s),u),p={trainerId:e,email:t.email,firstName:t.firstName,lastName:t.lastName,joinDate:m.toISOString(),status:"pending",fitnessLevel:t.fitnessLevel||"beginner",goals:t.goals||[],notes:t.notes,totalSessions:0,invitationId:h.id};await (0,a.gS)((0,a.rJ)(i.db,n),p);try{var r;let e=(null===i.j2||void 0===i.j2||null==(r=i.j2.currentUser)?void 0:r.displayName)||"Your Trainer";fetch("/api/email/invite",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({traineeEmail:t.email,trainerName:e,traineeFirstName:t.firstName,invitationToken:c})}).then(async e=>{if(!e.ok){let t=await e.text();console.warn("Invitation email API responded with non-OK:",t)}}).catch(e=>{console.warn("Invitation email API call failed:",e)})}catch(e){console.error("Error initiating invitation email:",e)}return h.id}catch(e){throw console.error("Error inviting trainee:",e),e}}static async getTraineesByTrainer(e){try{if(!i.db)throw Error("Firebase Firestore not initialized");let t=(0,a.P)((0,a.rJ)(i.db,n),(0,a._M)("trainerId","==",e),(0,a.My)("joinDate","desc")),r=await (0,a.GG)(t),s=[];return r.forEach(e=>{s.push({id:e.id,...e.data()})}),s}catch(e){throw console.error("Error getting trainees:",e),e}}static async getTraineeById(e){try{if(!i.db)throw Error("Firebase Firestore not initialized");let t=(0,a.H9)(i.db,n,e),r=await (0,a.x7)(t);if(r.exists())return{id:r.id,...r.data()};return null}catch(e){throw console.error("Error getting trainee:",e),e}}static async updateTrainee(e,t){try{if(!i.db)throw Error("Firebase Firestore not initialized");let r=(0,a.H9)(i.db,n,e);await (0,a.mZ)(r,{...t,updatedAt:new Date().toISOString()})}catch(e){throw console.error("Error updating trainee:",e),e}}static async deleteTrainee(e){try{if(!i.db)throw Error("Firebase Firestore not initialized");let t=(0,a.H9)(i.db,n,e),r=await (0,a.x7)(t);if(!r.exists())return;{let e=r.data(),n=e.trainerId,l=e.email;if(await (0,a.kd)(t),n&&l){let e=(0,a.P)((0,a.rJ)(i.db,s),(0,a._M)("trainerId","==",n),(0,a._M)("email","==",l)),t=await (0,a.GG)(e),r=[];t.forEach(e=>{r.push((0,a.kd)(e.ref))}),r.length>0&&await Promise.all(r)}}}catch(e){throw console.error("Error deleting trainee:",e),e}}static async getInvitationByToken(e){try{if(!i.db)throw Error("Firebase Firestore not initialized");let t=(0,a.P)((0,a.rJ)(i.db,s),(0,a._M)("inviteToken","==",e),(0,a._M)("status","==","pending")),r=await (0,a.GG)(t);if(r.empty)return null;let n=r.docs[0],l={id:n.id,...n.data()};if(new Date(l.expiresAt)<new Date)return await this.expireInvitation(l.id),null;return l}catch(e){throw console.error("Error getting invitation by token:",e),e}}static async acceptInvitation(e,t){try{if(!i.db)throw Error("Firebase Firestore not initialized");let r=(0,a.H9)(i.db,s,e);await (0,a.mZ)(r,{status:"accepted",acceptedAt:new Date().toISOString()});let l=(0,a.P)((0,a.rJ)(i.db,n),(0,a._M)("invitationId","==",e)),d=await (0,a.GG)(l);if(!d.empty){let e=d.docs[0],r=(0,a.H9)(i.db,n,e.id);await (0,a.mZ)(r,{userId:t,status:"active",updatedAt:new Date().toISOString()})}}catch(e){throw console.error("Error accepting invitation:",e),e}}static async expireInvitation(e){try{if(!i.db)throw Error("Firebase Firestore not initialized");let t=(0,a.H9)(i.db,s,e);await (0,a.mZ)(t,{status:"expired"})}catch(e){throw console.error("Error expiring invitation:",e),e}}static async resendInvitation(e){try{if(!i.db)throw Error("Firebase Firestore not initialized");let t=l(),r=new Date(Date.now()+6048e5),n=(0,a.H9)(i.db,s,e);return await (0,a.mZ)(n,{inviteToken:t,status:"pending",expiresAt:r.toISOString(),resentAt:new Date().toISOString()}),t}catch(e){throw console.error("Error resending invitation:",e),e}}static async getPendingInvitations(e){try{if(!i.db)throw Error("Firebase Firestore not initialized");let t=(0,a.P)((0,a.rJ)(i.db,s),(0,a._M)("trainerId","==",e),(0,a._M)("status","==","pending"),(0,a.My)("invitedAt","desc")),r=await (0,a.GG)(t),n=[];return r.forEach(e=>{n.push({id:e.id,...e.data()})}),n}catch(e){throw console.error("Error getting pending invitations:",e),e}}}},9129:(e,t,r)=>{Promise.resolve().then(r.bind(r,758))}},e=>{e.O(0,[992,416,914,533,441,493,358],()=>e(e.s=9129)),_N_E=e.O()}]);