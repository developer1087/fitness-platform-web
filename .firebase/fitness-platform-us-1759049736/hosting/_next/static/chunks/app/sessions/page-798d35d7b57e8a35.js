(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[898],{313:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>g});var s=r(5155),i=r(2115),a=r(8576),n=r(1914),o=r(9708),l=r(4585);let d="training_sessions",c="session_templates",u="personal_records";class m{static async createSession(e,t){try{if(!l.db)throw Error("Firebase Firestore not initialized");let r=new Date().toISOString(),s={trainerId:e,traineeId:t.traineeId,title:t.title,description:t.description,type:t.type,status:"scheduled",scheduledDate:t.scheduledDate,startTime:t.startTime,duration:t.duration,location:t.location,exercises:[],completedExercises:0,totalExercises:0,trainerNotes:t.trainerNotes,personalRecords:[],isPaid:!1,sessionRate:t.sessionRate,createdAt:r,updatedAt:r};if(t.templateId){let e=await this.getSessionTemplate(t.templateId);e&&(s.exercises=e.exercises.map((e,t)=>({id:"".concat(Date.now(),"-").concat(t),exerciseId:e.exerciseId,exercise:{},order:e.order,plannedSets:[],actualSets:[],coachingCues:e.coachingCues||[]})),s.totalExercises=e.exercises.length)}return(await (0,o.gS)((0,o.rJ)(l.db,d),s)).id}catch(e){throw console.error("Error creating session:",e),e}}static async getTrainerSessions(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{if(!l.db)throw Error("Firebase Firestore not initialized");let r=(0,o.P)((0,o.rJ)(l.db,d),(0,o._M)("trainerId","==",e),(0,o.My)("scheduledDate","desc"));t.status&&(r=(0,o.P)(r,(0,o._M)("status","==",t.status))),t.limit&&(r=(0,o.P)(r,(0,o.AB)(t.limit)));let s=await (0,o.GG)(r),i=[];if(s.forEach(e=>{i.push({id:e.id,...e.data()})}),t.startDate||t.endDate)return i.filter(e=>{let r=new Date(e.scheduledDate);return!(t.startDate&&r<new Date(t.startDate)||t.endDate&&r>new Date(t.endDate))});return i}catch(e){throw console.error("Error getting trainer sessions:",e),e}}static async getTraineeSessions(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{if(!l.db)throw Error("Firebase Firestore not initialized");let r=(0,o.P)((0,o.rJ)(l.db,d),(0,o._M)("traineeId","==",e),(0,o.My)("scheduledDate","desc"));t.status&&(r=(0,o.P)(r,(0,o._M)("status","==",t.status))),t.limit&&(r=(0,o.P)(r,(0,o.AB)(t.limit)));let s=await (0,o.GG)(r),i=[];return s.forEach(e=>{i.push({id:e.id,...e.data()})}),i}catch(e){throw console.error("Error getting trainee sessions:",e),e}}static async getSession(e){try{if(!l.db)throw Error("Firebase Firestore not initialized");let t=(0,o.H9)(l.db,d,e),r=await (0,o.x7)(t);if(r.exists())return{id:r.id,...r.data()};return null}catch(e){throw console.error("Error getting session:",e),e}}static async updateSessionStatus(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{if(!l.db)throw Error("Firebase Firestore not initialized");let s=(0,o.H9)(l.db,d,e);await (0,o.mZ)(s,{status:t,...r,updatedAt:new Date().toISOString()})}catch(e){throw console.error("Error updating session status:",e),e}}static async startSession(e){let t=new Date().toISOString();await this.updateSessionStatus(e,"in_progress",{actualStartTime:t})}static async completeSession(e,t){try{if(!l.db)throw Error("Firebase Firestore not initialized");let r=new Date().toISOString(),s=(0,o.wP)(l.db),i=(0,o.H9)(l.db,d,e);if(s.update(i,{status:"completed",actualEndTime:r,completedAt:r,sessionNotes:t.sessionNotes,traineePerformance:t.traineePerformance,updatedAt:r}),t.personalRecords&&t.personalRecords.length>0)for(let i of t.personalRecords){let t=(0,o.H9)((0,o.rJ)(l.db,u));s.set(t,{...i,id:t.id,sessionId:e,createdAt:r})}await s.commit()}catch(e){throw console.error("Error completing session:",e),e}}static async deleteSession(e){try{if(!l.db)throw Error("Firebase Firestore not initialized");let t=(0,o.H9)(l.db,d,e);await (0,o.kd)(t)}catch(e){throw console.error("Error deleting session:",e),e}}static async createSessionTemplate(e,t){try{if(!l.db)throw Error("Firebase Firestore not initialized");let r=new Date().toISOString(),s={...t,trainerId:e,timesUsed:0,createdAt:r,updatedAt:r};return(await (0,o.gS)((0,o.rJ)(l.db,c),s)).id}catch(e){throw console.error("Error creating session template:",e),e}}static async getSessionTemplates(e){try{if(!l.db)throw Error("Firebase Firestore not initialized");let t=(0,o.P)((0,o.rJ)(l.db,c),(0,o._M)("trainerId","==",e),(0,o.My)("name","asc")),r=await (0,o.GG)(t),s=[];return r.forEach(e=>{s.push({id:e.id,...e.data()})}),s}catch(e){throw console.error("Error getting session templates:",e),e}}static async getSessionTemplate(e){try{if(!l.db)throw Error("Firebase Firestore not initialized");let t=(0,o.H9)(l.db,c,e),r=await (0,o.x7)(t);if(r.exists())return{id:r.id,...r.data()};return null}catch(e){throw console.error("Error getting session template:",e),e}}static async getTraineePersonalRecords(e){try{if(!l.db)throw Error("Firebase Firestore not initialized");let t=(0,o.P)((0,o.rJ)(l.db,u),(0,o._M)("traineeId","==",e),(0,o.My)("createdAt","desc")),r=await (0,o.GG)(t),s=[];return r.forEach(e=>{s.push({id:e.id,...e.data()})}),s}catch(e){throw console.error("Error getting personal records:",e),e}}static async generateSessionStats(e,t){try{if(!l.db)throw Error("Firebase Firestore not initialized");let r=new Date,s=new Date;switch(t){case"week":s.setDate(r.getDate()-7);break;case"month":s.setMonth(r.getMonth()-1);break;case"quarter":s.setMonth(r.getMonth()-3);break;case"year":s.setFullYear(r.getFullYear()-1)}let i=await this.getTrainerSessions(e,{startDate:s.toISOString(),endDate:r.toISOString()}),a=i.length,n=i.filter(e=>"completed"===e.status).length,o=i.filter(e=>"cancelled"===e.status).length,d=i.filter(e=>"no_show"===e.status).length,c=i.reduce((e,t)=>{if(t.actualStartTime&&t.actualEndTime){let r=new Date(t.actualEndTime).getTime()-new Date(t.actualStartTime).getTime();return e+r/6e4}return e+t.duration},0)/(a||1),u=(await Promise.all(i.map(e=>e.traineeId).filter((e,t,r)=>r.indexOf(e)===t).map(e=>this.getTraineePersonalRecords(e)))).flat().filter(e=>new Date(e.createdAt)>=s).length;return{trainerId:e,period:t,totalSessions:a,completedSessions:n,cancelledSessions:o,noShowSessions:d,averageSessionDuration:c,averageSessionRating:0,personalRecordsSet:u,clientRetentionRate:0,averageClientProgress:0,newClients:0,strengthSessions:i.filter(e=>"personal_training"===e.type).length,cardioSessions:0,assessmentSessions:i.filter(e=>"assessment"===e.type).length,otherSessions:i.filter(e=>!["personal_training","assessment"].includes(e.type)).length,generatedAt:new Date().toISOString()}}catch(e){throw console.error("Error generating session stats:",e),e}}static async getUpcomingSessions(e){let t=new Date,r=new Date;return r.setDate(t.getDate()+7),this.getTrainerSessions(e,{startDate:t.toISOString(),endDate:r.toISOString(),status:"scheduled"})}static async getTodaySessions(e){let t=new Date,r=new Date;return r.setDate(t.getDate()+1),this.getTrainerSessions(e,{startDate:t.toISOString(),endDate:r.toISOString()})}}var h=r(5915);function g(){let{user:e}=(0,a.A)(),[t,r]=(0,i.useState)([]),[o,l]=(0,i.useState)([]),[d,c]=(0,i.useState)(!0),[u,g]=(0,i.useState)(null),[p,b]=(0,i.useState)("today"),[y,f]=(0,i.useState)(!1);(0,i.useEffect)(()=>{(null==e?void 0:e.uid)&&(w(),v())},[e,p]);let w=async()=>{if(null==e?void 0:e.uid){c(!0),g(null);try{let t=[];switch(p){case"today":t=await m.getTodaySessions(e.uid);break;case"upcoming":t=await m.getUpcomingSessions(e.uid);break;case"completed":t=await m.getTrainerSessions(e.uid,{status:"completed",limit:20});break;default:t=await m.getTrainerSessions(e.uid,{limit:50})}r(t)}catch(e){console.error("Error loading sessions:",e),g("Failed to load sessions")}finally{c(!1)}}},v=async()=>{if(null==e?void 0:e.uid)try{let t=await h.g.getTraineesByTrainer(e.uid);l(t.filter(e=>"active"===e.status))}catch(e){console.error("Error loading trainees:",e)}},j=async t=>{if(null==e?void 0:e.uid)try{await m.createSession(e.uid,t),f(!1),w()}catch(e){console.error("Error creating session:",e),g("Failed to create session")}},N=async(e,t)=>{try{await m.updateSessionStatus(e,t),w()}catch(e){console.error("Error updating session status:",e),g("Failed to update session")}};return e?(0,s.jsxs)(n.A,{currentPage:"sessions",children:[(0,s.jsx)("div",{className:"bg-white shadow-sm border-b",children:(0,s.jsx)("div",{className:"px-6 py-4",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Training Sessions"}),(0,s.jsxs)("button",{onClick:()=>f(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors flex items-center",children:[(0,s.jsx)("svg",{className:"w-5 h-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Create Session"]})]})})}),(0,s.jsxs)("div",{className:"p-6",children:[u&&(0,s.jsx)("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 text-red-700 rounded-md",children:u}),(0,s.jsx)("div",{className:"mb-6",children:(0,s.jsx)("nav",{className:"flex space-x-8",children:[{key:"today",label:"Today",count:t.filter(e=>{let t=new Date().toDateString();return new Date(e.scheduledDate).toDateString()===t}).length},{key:"upcoming",label:"Upcoming",count:t.filter(e=>new Date(e.scheduledDate)>new Date&&"completed"!==e.status).length},{key:"completed",label:"Completed",count:t.filter(e=>"completed"===e.status).length},{key:"all",label:"All Sessions",count:t.length}].map(e=>(0,s.jsxs)("button",{onClick:()=>b(e.key),className:"py-2 px-1 border-b-2 font-medium text-sm ".concat(p===e.key?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[e.label,e.count>0&&(0,s.jsx)("span",{className:"ml-2 py-0.5 px-2 rounded-full text-xs ".concat(p===e.key?"bg-blue-100 text-blue-600":"bg-gray-100 text-gray-900"),children:e.count})]},e.key))})}),d?(0,s.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsxs)("svg",{className:"animate-spin h-8 w-8 text-blue-600 mx-auto",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,s.jsx)("p",{className:"mt-2 text-gray-600",children:"Loading sessions..."})]})}):0===t.length?(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),(0,s.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No sessions found"}),(0,s.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Get started by creating your first training session."}),(0,s.jsx)("div",{className:"mt-6",children:(0,s.jsx)("button",{onClick:()=>f(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors",children:"Create Session"})})]}):(0,s.jsx)("div",{className:"space-y-4",children:t.map(e=>{let t=o.find(t=>t.id===e.traineeId),r=new Date(e.scheduledDate),i=new Date(e.startTime);return(0,s.jsx)("div",{className:"bg-white rounded-lg shadow-sm border p-6 hover:shadow-md transition-shadow",children:(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("span",{className:"text-2xl",children:(e=>{switch(e){case"personal_training":return"\uD83C\uDFCB️";case"group_training":return"\uD83D\uDC65";case"assessment":return"\uD83D\uDCCA";case"consultation":return"\uD83D\uDCAC";default:return"\uD83D\uDCC5"}})(e.type)}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:e.title}),(0,s.jsxs)("p",{className:"text-sm text-gray-600",children:[t?"".concat(t.firstName," ").concat(t.lastName):"Unknown trainee"," • ",e.type.replace("_"," ")]})]})]}),(0,s.jsxs)("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-medium text-gray-500",children:"Date & Time:"}),(0,s.jsxs)("p",{className:"text-gray-900",children:[r.toLocaleDateString()," at ",i.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-medium text-gray-500",children:"Duration:"}),(0,s.jsxs)("p",{className:"text-gray-900",children:[e.duration," minutes"]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-medium text-gray-500",children:"Location:"}),(0,s.jsx)("p",{className:"text-gray-900",children:e.location||"Not specified"})]})]}),e.description&&(0,s.jsxs)("div",{className:"mt-3",children:[(0,s.jsx)("span",{className:"font-medium text-gray-500 text-sm",children:"Description:"}),(0,s.jsx)("p",{className:"text-gray-900 text-sm mt-1",children:e.description})]})]}),(0,s.jsxs)("div",{className:"flex flex-col items-end space-y-3",children:[(0,s.jsx)("span",{className:"px-3 py-1 rounded-full text-xs font-medium ".concat((e=>{let t={scheduled:"bg-blue-100 text-blue-800",confirmed:"bg-green-100 text-green-800",in_progress:"bg-orange-100 text-orange-800",completed:"bg-emerald-100 text-emerald-800",cancelled:"bg-red-100 text-red-800",no_show:"bg-gray-100 text-gray-800",rescheduled:"bg-yellow-100 text-yellow-800"};return t[e]||t.scheduled})(e.status)),children:e.status.replace("_"," ")}),(0,s.jsxs)("div",{className:"flex space-x-2",children:["scheduled"===e.status&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{onClick:()=>N(e.id,"in_progress"),className:"bg-green-600 text-white px-3 py-1 rounded text-xs hover:bg-green-700 transition-colors",children:"Start"}),(0,s.jsx)("button",{onClick:()=>N(e.id,"cancelled"),className:"bg-red-600 text-white px-3 py-1 rounded text-xs hover:bg-red-700 transition-colors",children:"Cancel"})]}),"in_progress"===e.status&&(0,s.jsx)("button",{onClick:()=>N(e.id,"completed"),className:"bg-blue-600 text-white px-3 py-1 rounded text-xs hover:bg-blue-700 transition-colors",children:"Complete"}),(0,s.jsx)("button",{className:"text-gray-400 hover:text-gray-600 px-2 py-1",children:(0,s.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})})]})]})]})},e.id)})})]}),y&&(0,s.jsx)(x,{trainees:o,onClose:()=>f(!1),onSubmit:j})]}):(0,s.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsxs)("svg",{className:"animate-spin h-8 w-8 text-blue-600 mx-auto",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,s.jsx)("p",{className:"mt-2 text-gray-600",children:"Loading..."})]})})}function x(e){let{trainees:t,onClose:r,onSubmit:a}=e,[n,o]=(0,i.useState)({traineeId:"",title:"",description:"",type:"personal_training",scheduledDate:new Date().toISOString().split("T")[0],startTime:"",duration:60,location:"",sessionRate:0,trainerNotes:""}),[l,d]=(0,i.useState)({}),[c,u]=(0,i.useState)(!1),m=async e=>{e.preventDefault();let t={};if(n.traineeId||(t.traineeId="Please select a trainee"),n.title||(t.title="Title is required"),n.startTime||(t.startTime="Start time is required"),Object.keys(t).length>0)return void d(t);u(!0);try{await a(n)}catch(e){console.error("Error submitting form:",e)}finally{u(!1)}};return(0,s.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,s.jsx)("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Create Training Session"}),(0,s.jsx)("button",{onClick:r,className:"text-gray-400 hover:text-gray-600",children:(0,s.jsx)("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,s.jsxs)("form",{onSubmit:m,className:"space-y-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Trainee"}),(0,s.jsxs)("select",{value:n.traineeId,onChange:e=>o({...n,traineeId:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,s.jsx)("option",{value:"",children:"Select a trainee"}),t.map(e=>(0,s.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id))]}),l.traineeId&&(0,s.jsx)("p",{className:"text-sm text-red-600 mt-1",children:l.traineeId})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Session Type"}),(0,s.jsxs)("select",{value:n.type,onChange:e=>o({...n,type:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,s.jsx)("option",{value:"personal_training",children:"Personal Training"}),(0,s.jsx)("option",{value:"group_training",children:"Group Training"}),(0,s.jsx)("option",{value:"assessment",children:"Assessment"}),(0,s.jsx)("option",{value:"consultation",children:"Consultation"}),(0,s.jsx)("option",{value:"follow_up",children:"Follow-up"})]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Session Title"}),(0,s.jsx)("input",{type:"text",value:n.title,onChange:e=>o({...n,title:e.target.value}),placeholder:"e.g., Strength Training Session",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),l.title&&(0,s.jsx)("p",{className:"text-sm text-red-600 mt-1",children:l.title})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),(0,s.jsx)("textarea",{value:n.description,onChange:e=>o({...n,description:e.target.value}),rows:3,placeholder:"Optional session description...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date"}),(0,s.jsx)("input",{type:"date",value:n.scheduledDate,onChange:e=>o({...n,scheduledDate:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Start Time"}),(0,s.jsx)("input",{type:"time",value:n.startTime,onChange:e=>o({...n,startTime:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),l.startTime&&(0,s.jsx)("p",{className:"text-sm text-red-600 mt-1",children:l.startTime})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Duration (minutes)"}),(0,s.jsx)("input",{type:"number",min:"15",max:"180",value:n.duration,onChange:e=>o({...n,duration:parseInt(e.target.value)||60}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Location"}),(0,s.jsx)("input",{type:"text",value:n.location,onChange:e=>o({...n,location:e.target.value}),placeholder:"e.g., Main Gym, Studio A",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Session Rate ($)"}),(0,s.jsx)("input",{type:"number",min:"0",value:n.sessionRate,onChange:e=>o({...n,sessionRate:parseFloat(e.target.value)||0}),placeholder:"0",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Trainer Notes"}),(0,s.jsx)("textarea",{value:n.trainerNotes,onChange:e=>o({...n,trainerNotes:e.target.value}),rows:3,placeholder:"Pre-session notes, goals, or reminders...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,s.jsx)("button",{type:"button",onClick:r,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors",children:"Cancel"}),(0,s.jsx)("button",{type:"submit",disabled:c,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors disabled:opacity-50",children:c?"Creating...":"Create Session"})]})]})]})})})}},5915:(e,t,r)=>{"use strict";r.d(t,{g:()=>l});var s=r(9708),i=r(4585);let a="trainee_invitations",n="trainees";function o(){let e=new Uint8Array(32);return crypto.getRandomValues(e),Array.from(e,e=>e.toString(16).padStart(2,"0")).join("")}class l{static async inviteTrainee(e,t){try{if(!i.db)throw Error("Firebase Firestore not initialized");let l=(0,s.P)((0,s.rJ)(i.db,n),(0,s._M)("trainerId","==",e),(0,s._M)("email","==",t.email));if(!(await (0,s.GG)(l)).empty)throw Error("A trainee with this email already exists");let d=(0,s.P)((0,s.rJ)(i.db,a),(0,s._M)("trainerId","==",e),(0,s._M)("email","==",t.email),(0,s._M)("status","==","pending"));if(!(await (0,s.GG)(d)).empty)throw Error("An invitation is already pending for this email");let c=o(),u=new Date,m=new Date(u.getTime()+6048e5),h={trainerId:e,email:t.email,firstName:t.firstName,lastName:t.lastName,fitnessLevel:t.fitnessLevel,goals:t.goals||[],notes:t.notes,status:"pending",inviteToken:c,invitedAt:u.toISOString(),expiresAt:m.toISOString()},g=await (0,s.gS)((0,s.rJ)(i.db,a),h),x={trainerId:e,email:t.email,firstName:t.firstName,lastName:t.lastName,joinDate:u.toISOString(),status:"pending",fitnessLevel:t.fitnessLevel||"beginner",goals:t.goals||[],notes:t.notes,totalSessions:0,invitationId:g.id};await (0,s.gS)((0,s.rJ)(i.db,n),x);try{var r;let e=(null===i.j2||void 0===i.j2||null==(r=i.j2.currentUser)?void 0:r.displayName)||"Your Trainer";fetch("/api/email/invite",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({traineeEmail:t.email,trainerName:e,traineeFirstName:t.firstName,invitationToken:c})}).then(async e=>{if(!e.ok){let t=await e.text();console.warn("Invitation email API responded with non-OK:",t)}}).catch(e=>{console.warn("Invitation email API call failed:",e)})}catch(e){console.error("Error initiating invitation email:",e)}return g.id}catch(e){throw console.error("Error inviting trainee:",e),e}}static async getTraineesByTrainer(e){try{if(!i.db)throw Error("Firebase Firestore not initialized");let t=(0,s.P)((0,s.rJ)(i.db,n),(0,s._M)("trainerId","==",e),(0,s.My)("joinDate","desc")),r=await (0,s.GG)(t),a=[];return r.forEach(e=>{a.push({id:e.id,...e.data()})}),a}catch(e){throw console.error("Error getting trainees:",e),e}}static async getTraineeById(e){try{if(!i.db)throw Error("Firebase Firestore not initialized");let t=(0,s.H9)(i.db,n,e),r=await (0,s.x7)(t);if(r.exists())return{id:r.id,...r.data()};return null}catch(e){throw console.error("Error getting trainee:",e),e}}static async updateTrainee(e,t){try{if(!i.db)throw Error("Firebase Firestore not initialized");let r=(0,s.H9)(i.db,n,e);await (0,s.mZ)(r,{...t,updatedAt:new Date().toISOString()})}catch(e){throw console.error("Error updating trainee:",e),e}}static async deleteTrainee(e){try{if(!i.db)throw Error("Firebase Firestore not initialized");let t=(0,s.H9)(i.db,n,e),r=await (0,s.x7)(t);if(!r.exists())return;{let e=r.data(),n=e.trainerId,o=e.email;if(await (0,s.kd)(t),n&&o){let e=(0,s.P)((0,s.rJ)(i.db,a),(0,s._M)("trainerId","==",n),(0,s._M)("email","==",o)),t=await (0,s.GG)(e),r=[];t.forEach(e=>{r.push((0,s.kd)(e.ref))}),r.length>0&&await Promise.all(r)}}}catch(e){throw console.error("Error deleting trainee:",e),e}}static async getInvitationByToken(e){try{if(!i.db)throw Error("Firebase Firestore not initialized");let t=(0,s.P)((0,s.rJ)(i.db,a),(0,s._M)("inviteToken","==",e),(0,s._M)("status","==","pending")),r=await (0,s.GG)(t);if(r.empty)return null;let n=r.docs[0],o={id:n.id,...n.data()};if(new Date(o.expiresAt)<new Date)return await this.expireInvitation(o.id),null;return o}catch(e){throw console.error("Error getting invitation by token:",e),e}}static async acceptInvitation(e,t){try{if(!i.db)throw Error("Firebase Firestore not initialized");let r=(0,s.H9)(i.db,a,e);await (0,s.mZ)(r,{status:"accepted",acceptedAt:new Date().toISOString()});let o=(0,s.P)((0,s.rJ)(i.db,n),(0,s._M)("invitationId","==",e)),l=await (0,s.GG)(o);if(!l.empty){let e=l.docs[0],r=(0,s.H9)(i.db,n,e.id);await (0,s.mZ)(r,{userId:t,status:"active",updatedAt:new Date().toISOString()})}}catch(e){throw console.error("Error accepting invitation:",e),e}}static async expireInvitation(e){try{if(!i.db)throw Error("Firebase Firestore not initialized");let t=(0,s.H9)(i.db,a,e);await (0,s.mZ)(t,{status:"expired"})}catch(e){throw console.error("Error expiring invitation:",e),e}}static async resendInvitation(e){try{if(!i.db)throw Error("Firebase Firestore not initialized");let t=o(),r=new Date(Date.now()+6048e5),n=(0,s.H9)(i.db,a,e);return await (0,s.mZ)(n,{inviteToken:t,status:"pending",expiresAt:r.toISOString(),resentAt:new Date().toISOString()}),t}catch(e){throw console.error("Error resending invitation:",e),e}}static async getPendingInvitations(e){try{if(!i.db)throw Error("Firebase Firestore not initialized");let t=(0,s.P)((0,s.rJ)(i.db,a),(0,s._M)("trainerId","==",e),(0,s._M)("status","==","pending"),(0,s.My)("invitedAt","desc")),r=await (0,s.GG)(t),n=[];return r.forEach(e=>{n.push({id:e.id,...e.data()})}),n}catch(e){throw console.error("Error getting pending invitations:",e),e}}}},6563:(e,t,r)=>{Promise.resolve().then(r.bind(r,313))}},e=>{e.O(0,[992,416,914,533,441,493,358],()=>e(e.s=6563)),_N_E=e.O()}]);